#!/bin/bash

# Step 1: Welcome and initial messages
echo "Welcome to the SoftUi Exploit."
sleep 1
echo "Install version 1."
sleep 1
echo "Checking License..."
sleep 8

# Step 2: Prompt for license key
read -p $'\rEnter License Key:       \b\b\b\b\b\b' license_key
sleep 1

# Step 3: Check license and proceed
if [ "$license_key" == "debug" ]; then
    echo "Done."
    echo -e "Whitelist Verified."

    # Step 4: Downloading and installing Roblox
    echo -e "Downloading Latest Roblox..."
    
    # Remove old RobloxPlayer.zip if exists
    [ -f ./RobloxPlayer.zip ] && rm ./RobloxPlayer.zip
    
    # Fetch version information
    robloxVersionInfo=$(curl -s "https://clientsettingscdn.roblox.com/v2/client-version/MacPlayer")
    versionInfo=$(curl -s "https://git.raptor.fun/main/version.json")
    
    # Extract channel and version info using jq
    mChannel=$(echo "$versionInfo" | ./jq -r ".channel")
    version=$(echo "$versionInfo" | ./jq -r ".clientVersionUpload")
    robloxVersion=$(echo "$robloxVersionInfo" | ./jq -r ".clientVersionUpload")
    
    # Check if versions are different and the channel is "preview"
    if [ "$version" != "$robloxVersion" ] && [ "$mChannel" == "preview" ]; then
        curl "http://setup.rbxcdn.com/mac/$robloxVersion-RobloxPlayer.zip" -o "./RobloxPlayer.zip"
    else
        curl "http://setup.rbxcdn.com/mac/$version-RobloxPlayer.zip" -o "./RobloxPlayer.zip"
    fi
    
    # Remove jq
    rm ./jq
    
    # Step 5: Installing Roblox
    echo -n "Installing Latest Roblox... "
    [ -d "/Applications/Roblox.app" ] && rm -rf "/Applications/Roblox.app"
    unzip -o -q "./RobloxPlayer.zip"
    mv ./RobloxPlayer.app /Applications/Roblox.app
    rm ./RobloxPlayer.zip
    echo -e "Done."

    # Step 6: Create file in Applications
    echo -e "Done." > "/Applications/SoftUi Exploit"
else
    echo "Invalid License Key."
fi
